# Bunをベースイメージとして使用
FROM oven/bun:latest

WORKDIR /app

# 依存関係のインストール
COPY package.json ./
RUN bun install --production

# 開発依存関係のインストール（TypeScript用）
RUN bun add -d typescript @types/node @types/bun

# ソースコードをコピー
COPY tsconfig.server.json ./
COPY server ./server

# TypeScriptをコンパイル
RUN bun run tsc -p tsconfig.server.json

# ポートを公開
EXPOSE 3003

# 起動コマンド
CMD ["bun", "run", "dist-server/index.js"]